# Story 10.1: Target Depletion Input Implementation Plan

## Overview

Implement a new "Spending Target" input that lets users specify what percentage of their portfolio they want to spend by a certain age. This is the foundation for Epic 10 (Intentional Portfolio Depletion Controls), enabling users to plan intentional spending rather than just portfolio preservation.

## Current State Analysis

### What Exists

1. **Data Model Pattern**: `SpendingPhaseConfig` in `types.ts:94-97` provides the exact pattern to follow - an `enabled` boolean with configuration object
2. **Database Pattern**: JSONB columns in `financial-snapshot.ts:132` store complex settings as typed objects
3. **UI Pattern**: `SpendingPhaseEditor` component embedded as Collapsible section on Profile page with inline save
4. **Validation Pattern**: Zod schemas in `projections.ts` with cross-field validation via `.refine()`
5. **API Pattern**: `/api/profile` PATCH endpoint handles JSONB field updates (lines 79-82)

### Key Discoveries

- `SpendingPhaseConfig` follows opt-in pattern with `enabled: boolean` (types.ts:95)
- Profile page uses `Collapsible` component for inline editing sections (profile-client.tsx:599-608)
- Validation splits static constraints (Zod schema) from dynamic constraints (runtime function)
- `profileUpdateSchema` merges schemas then applies `.partial()` (profile.ts:20-29)

## Desired End State

After implementation:
1. Users can enable/disable a depletion target on their Profile page
2. When enabled, they can set a target percentage (0-100%) and target age
3. Input validates against current age and life expectancy
4. Depletion target persists to database as JSONB field
5. Clear messaging distinguishes "spending target" from "failure scenario"
6. Changes are available for projection engine use (Story 10.2)

### Verification

- [ ] Profile page shows "Spending Target" collapsible section
- [ ] Toggle enables/disables the feature
- [ ] Percentage slider/input works (0-100%)
- [ ] Age slider/input works (currentAge+1 to maxAge)
- [ ] Validation errors show for invalid age ranges
- [ ] Save persists to database
- [ ] Refresh preserves saved state

## What We're NOT Doing

- **Engine calculations**: Story 10.2 handles projection engine integration
- **Visualization**: Story 10.3 handles chart display
- **Multiple targets**: Explicitly out of scope per story definition
- **Reserve warnings**: Story 10.2 handles safety thresholds

---

## Implementation Approach

Follow the `SpendingPhaseConfig` pattern exactly:
1. Add interface and JSONB type (data layer)
2. Add database migration
3. Add validation schema
4. Update API endpoint
5. Create UI component
6. Add to Profile page

---

## Phase 1: Data Model & Schema

### Overview
Add the `DepletionTarget` type definitions and database migration.

### Changes Required

#### 1. Add DepletionTarget Interface
**File**: `src/lib/projections/types.ts`
**Location**: After `SpendingPhaseConfig` (line 97)

```typescript
/**
 * Epic 10: Intentional Portfolio Depletion Target
 * Allows users to specify how much they want to spend by a certain age
 */
export interface DepletionTarget {
  enabled: boolean;
  targetPercentageSpent: number;  // 0-100, e.g., 75 means spend 75% by target age
  targetAge: number;              // Age by which to reach spending target
}
```

#### 2. Extend ProjectionInput Interface
**File**: `src/lib/projections/types.ts`
**Location**: Add to `ProjectionInput` interface (after line 145)

```typescript
  /** Epic 10: Optional depletion target configuration */
  depletionTarget?: DepletionTarget;
```

#### 3. Add JSONB Type Definition
**File**: `src/db/schema/financial-snapshot.ts`
**Location**: After `SpendingPhaseConfigJson` (line 68)

```typescript
// Epic 10: Depletion target configuration type
export type DepletionTargetJson = {
  enabled: boolean;
  targetPercentageSpent: number;
  targetAge: number;
};
```

#### 4. Add Database Column
**File**: `src/db/schema/financial-snapshot.ts`
**Location**: After `spendingPhases` column (line 132)

```typescript
  // Epic 10: Depletion target configuration
  depletionTarget: jsonb('depletion_target').$type<DepletionTargetJson>(),
```

#### 5. Create Database Migration
**File**: `src/db/migrations/XXXX_add_depletion_target.sql` (new file)

```sql
-- Epic 10: Add depletion target column for intentional portfolio spending
ALTER TABLE financial_snapshot
ADD COLUMN depletion_target JSONB;

-- Add comment for documentation
COMMENT ON COLUMN financial_snapshot.depletion_target IS 'Epic 10: User-defined portfolio spending target (percentage and age)';
```

### Success Criteria

#### Automated Verification:
- [x] TypeScript compiles without errors: `npm run typecheck`
- [x] Migration file exists and is valid SQL
- [x] Drizzle schema generates correctly: `npm run db:generate`

#### Manual Verification:
- [x] Migration applies cleanly to local database: `npm run db:migrate`
- [ ] New column visible in database schema

**Implementation Note**: Pause here for database migration verification before proceeding.

---

## Phase 2: Default Values & Validation

### Overview
Add default constants and Zod validation schema.

### Changes Required

#### 1. Add Default Constants
**File**: `src/lib/projections/assumptions.ts`
**Location**: After `getDefaultSpendingPhaseConfig` (line 116)

```typescript
import type { DepletionTarget } from './types';

/**
 * Epic 10: Default depletion target configuration
 * Disabled by default to avoid surprising existing users
 * Default values provide balanced starting point when enabled
 */
export const DEFAULT_DEPLETION_TARGET: DepletionTarget = {
  enabled: false,
  targetPercentageSpent: 50,  // Spend 50% of portfolio
  targetAge: 85,              // By age 85
};

/**
 * Get default depletion target adjusted for user's life expectancy
 * @param maxAge - User's life expectancy setting
 * @returns Default depletion target with age capped at maxAge - 5
 */
export function getDefaultDepletionTarget(maxAge: number): DepletionTarget {
  return {
    enabled: false,
    targetPercentageSpent: 50,
    targetAge: Math.min(85, maxAge - 5),  // 5 years before life expectancy
  };
}
```

#### 2. Add Validation Schema
**File**: `src/lib/validation/projections.ts`
**Location**: After `spendingPhaseConfigSchema` (line 48)

```typescript
/**
 * Epic 10: Depletion target validation schema
 * Note: Age constraints relative to currentAge/maxAge validated at runtime
 */
export const depletionTargetSchema = z.object({
  enabled: z.boolean(),
  targetPercentageSpent: z
    .number()
    .min(0, 'Spending percentage cannot be negative')
    .max(100, 'Spending percentage cannot exceed 100%'),
  targetAge: z
    .number()
    .int('Target age must be a whole number')
    .min(50, 'Target age must be at least 50')
    .max(120, 'Target age cannot exceed 120'),
});

/**
 * Cross-field validation for depletion target
 * Validates age constraints that require runtime context
 *
 * @param target - Depletion target to validate
 * @param currentAge - User's current age
 * @param maxAge - User's life expectancy setting
 * @returns Validation result with any errors
 */
export function validateDepletionTarget(
  target: DepletionTarget,
  currentAge: number,
  maxAge: number
): { valid: boolean; errors: string[] } {
  const errors: string[] = [];

  if (target.targetAge <= currentAge) {
    errors.push(
      `Target age (${target.targetAge}) must be greater than your current age (${currentAge})`
    );
  }

  if (target.targetAge > maxAge) {
    errors.push(
      `Target age (${target.targetAge}) cannot exceed your life expectancy (${maxAge})`
    );
  }

  return { valid: errors.length === 0, errors };
}
```

**Add import at top of file**:
```typescript
import type { DepletionTarget } from '@/lib/projections/types';
```

#### 3. Add to Profile Update Schema
**File**: `src/lib/validation/profile.ts`
**Location**: After `spendingPhasesSchema` (line 17)

```typescript
import { spendingPhaseConfigSchema, depletionTargetSchema } from './projections';

// Epic 10: Depletion target schema for profile updates
const depletionTargetUpdateSchema = z.object({
  depletionTarget: depletionTargetSchema.optional(),
});
```

**Update schema merge** (line 28):
```typescript
  .merge(spendingPhasesSchema)
  .merge(depletionTargetUpdateSchema)
  .partial();
```

### Success Criteria

#### Automated Verification:
- [x] TypeScript compiles: `npm run typecheck`
- [x] Linting passes: `npm run lint`
- [ ] Unit tests for validation pass (add tests)

#### Manual Verification:
- [ ] Schema validates correct input
- [ ] Schema rejects invalid percentage (< 0, > 100)
- [ ] Schema rejects invalid age (non-integer, < 50, > 120)

---

## Phase 3: API Integration

### Overview
Update the profile API endpoint to handle depletion target updates.

### Changes Required

#### 1. Update Profile PATCH Handler
**File**: `src/app/api/profile/route.ts`
**Location**: After spending phases handler (line 82)

```typescript
    // Epic 10: Depletion target
    if (data.depletionTarget !== undefined) {
      updateData.depletionTarget = data.depletionTarget;
    }
```

### Success Criteria

#### Automated Verification:
- [x] TypeScript compiles: `npm run typecheck`
- [x] API route handles PATCH with depletionTarget field

#### Manual Verification:
- [ ] Test with curl/Postman:
  ```bash
  curl -X PATCH http://localhost:3000/api/profile \
    -H "Content-Type: application/json" \
    -d '{"depletionTarget": {"enabled": true, "targetPercentageSpent": 75, "targetAge": 80}}'
  ```
- [ ] Verify data persists in database

---

## Phase 4: UI Component

### Overview
Create the `DepletionTargetInput` component following `SpendingPhaseEditor` patterns.

### Changes Required

#### 1. Create Component
**File**: `src/components/depletion-target-input.tsx` (new file)

```typescript
'use client';

import { useState, useCallback, useEffect } from 'react';
import { Label } from '@/components/ui/label';
import { Switch } from '@/components/ui/switch';
import { Slider } from '@/components/ui/slider';
import { Input } from '@/components/ui/input';
import { AlertCircle, Info } from 'lucide-react';
import type { DepletionTarget } from '@/lib/projections/types';
import { DEFAULT_DEPLETION_TARGET } from '@/lib/projections/assumptions';
import { validateDepletionTarget } from '@/lib/validation/projections';

interface DepletionTargetInputProps {
  target: DepletionTarget | undefined;
  currentAge: number;
  maxAge: number;
  portfolioValue: number;
  onChange: (target: DepletionTarget) => void;
}

export function DepletionTargetInput({
  target,
  currentAge,
  maxAge,
  portfolioValue,
  onChange,
}: DepletionTargetInputProps) {
  // Initialize with defaults if no target
  const [localTarget, setLocalTarget] = useState<DepletionTarget>(() => {
    if (target) return target;
    return {
      ...DEFAULT_DEPLETION_TARGET,
      targetAge: Math.min(85, maxAge - 5),
    };
  });

  // Local state for text inputs (allows typing without immediate validation)
  const [percentageInput, setPercentageInput] = useState(
    localTarget.targetPercentageSpent.toString()
  );
  const [ageInput, setAgeInput] = useState(localTarget.targetAge.toString());

  // Validation errors
  const [validationErrors, setValidationErrors] = useState<string[]>([]);

  // Validate when localTarget or constraints change
  useEffect(() => {
    if (localTarget.enabled) {
      const result = validateDepletionTarget(localTarget, currentAge, maxAge);
      setValidationErrors(result.errors);
    } else {
      setValidationErrors([]);
    }
  }, [localTarget, currentAge, maxAge]);

  const handleEnabledChange = useCallback((enabled: boolean) => {
    const newTarget = { ...localTarget, enabled };
    setLocalTarget(newTarget);
    onChange(newTarget);
  }, [localTarget, onChange]);

  const handleSliderChange = useCallback((field: 'targetPercentageSpent' | 'targetAge', value: number) => {
    const newTarget = { ...localTarget, [field]: value };
    setLocalTarget(newTarget);

    // Sync text input
    if (field === 'targetPercentageSpent') {
      setPercentageInput(value.toString());
    } else {
      setAgeInput(value.toString());
    }

    // Only save if valid
    const result = validateDepletionTarget(newTarget, currentAge, maxAge);
    if (result.valid) {
      onChange(newTarget);
    }
  }, [localTarget, currentAge, maxAge, onChange]);

  const handlePercentageBlur = useCallback(() => {
    const parsed = parseInt(percentageInput, 10);
    if (isNaN(parsed)) {
      setPercentageInput(localTarget.targetPercentageSpent.toString());
      return;
    }
    const clamped = Math.min(Math.max(parsed, 0), 100);
    setPercentageInput(clamped.toString());

    const newTarget = { ...localTarget, targetPercentageSpent: clamped };
    setLocalTarget(newTarget);

    const result = validateDepletionTarget(newTarget, currentAge, maxAge);
    if (result.valid) {
      onChange(newTarget);
    }
  }, [percentageInput, localTarget, currentAge, maxAge, onChange]);

  const handleAgeBlur = useCallback(() => {
    const parsed = parseInt(ageInput, 10);
    if (isNaN(parsed)) {
      setAgeInput(localTarget.targetAge.toString());
      return;
    }
    const clamped = Math.min(Math.max(parsed, 50), 120);
    setAgeInput(clamped.toString());

    const newTarget = { ...localTarget, targetAge: clamped };
    setLocalTarget(newTarget);

    const result = validateDepletionTarget(newTarget, currentAge, maxAge);
    if (result.valid) {
      onChange(newTarget);
    }
  }, [ageInput, localTarget, currentAge, maxAge, onChange]);

  // Calculate projected reserve
  const projectedReserve = portfolioValue * (1 - localTarget.targetPercentageSpent / 100);

  return (
    <div className="space-y-4">
      {/* Enable/Disable Toggle */}
      <div className="flex items-center justify-between">
        <div>
          <Label htmlFor="depletion-enabled" className="font-medium">
            Set a Spending Target
          </Label>
          <p className="text-sm text-muted-foreground">
            Plan how much of your portfolio you want to spend by a certain age
          </p>
        </div>
        <Switch
          id="depletion-enabled"
          checked={localTarget.enabled}
          onCheckedChange={handleEnabledChange}
        />
      </div>

      {/* Target Configuration */}
      {localTarget.enabled && (
        <div className="space-y-6 pt-4 border-t">
          {/* Info Banner */}
          <div className="flex gap-2 p-3 bg-blue-50 dark:bg-blue-950 rounded-lg text-sm">
            <Info className="h-4 w-4 mt-0.5 text-blue-600 dark:text-blue-400 flex-shrink-0" />
            <p className="text-blue-800 dark:text-blue-200">
              This is your <strong>spending goal</strong>, not a failure threshold.
              Setting a target helps you plan to enjoy your money intentionally.
            </p>
          </div>

          {/* Percentage Input */}
          <div className="space-y-2">
            <div className="flex justify-between items-center">
              <Label>Target spending by age {localTarget.targetAge}</Label>
              <div className="flex items-center gap-1">
                <Input
                  type="text"
                  value={percentageInput}
                  onChange={(e) => setPercentageInput(e.target.value)}
                  onBlur={handlePercentageBlur}
                  onKeyDown={(e) => {
                    if (e.key === 'Enter') {
                      handlePercentageBlur();
                      (e.target as HTMLInputElement).blur();
                    }
                  }}
                  className="w-16 h-7 text-right text-sm px-2"
                />
                <span className="text-sm text-muted-foreground">%</span>
              </div>
            </div>
            <Slider
              value={[localTarget.targetPercentageSpent]}
              min={0}
              max={100}
              step={5}
              onValueChange={([value]) => handleSliderChange('targetPercentageSpent', value)}
              formatValue={(v) => `${v}%`}
            />
            <p className="text-xs text-muted-foreground">
              Projected reserve: {new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                maximumFractionDigits: 0,
              }).format(projectedReserve)} ({100 - localTarget.targetPercentageSpent}% of current portfolio)
            </p>
          </div>

          {/* Age Input */}
          <div className="space-y-2">
            <div className="flex justify-between items-center">
              <Label>Target age</Label>
              <div className="flex items-center gap-1">
                <Input
                  type="text"
                  value={ageInput}
                  onChange={(e) => setAgeInput(e.target.value)}
                  onBlur={handleAgeBlur}
                  onKeyDown={(e) => {
                    if (e.key === 'Enter') {
                      handleAgeBlur();
                      (e.target as HTMLInputElement).blur();
                    }
                  }}
                  className="w-16 h-7 text-right text-sm px-2"
                />
              </div>
            </div>
            <Slider
              value={[localTarget.targetAge]}
              min={currentAge + 1}
              max={maxAge}
              step={1}
              onValueChange={([value]) => handleSliderChange('targetAge', value)}
              formatValue={(v) => `Age ${v}`}
            />
            <p className="text-xs text-muted-foreground">
              Must be between age {currentAge + 1} and {maxAge} (your life expectancy setting)
            </p>
          </div>

          {/* Validation Errors */}
          {validationErrors.length > 0 && (
            <div className="flex gap-2 p-3 bg-red-50 dark:bg-red-950 rounded-lg">
              <AlertCircle className="h-4 w-4 mt-0.5 text-red-600 dark:text-red-400 flex-shrink-0" />
              <div className="text-sm text-red-800 dark:text-red-200">
                {validationErrors.map((error, i) => (
                  <p key={i}>{error}</p>
                ))}
              </div>
            </div>
          )}

          {/* Summary */}
          <div className="p-3 bg-muted/50 rounded-lg text-sm">
            <p>
              <strong>Your goal:</strong> Spend {localTarget.targetPercentageSpent}% of your portfolio
              by age {localTarget.targetAge}, keeping {100 - localTarget.targetPercentageSpent}% in reserve.
            </p>
          </div>
        </div>
      )}
    </div>
  );
}
```

### Success Criteria

#### Automated Verification:
- [x] TypeScript compiles: `npm run typecheck`
- [x] Linting passes: `npm run lint`
- [ ] Component renders without errors in Storybook/tests

#### Manual Verification:
- [ ] Component renders correctly in isolation
- [ ] Toggle enables/disables feature
- [ ] Sliders move smoothly
- [ ] Text inputs accept valid values
- [ ] Validation errors display correctly

---

## Phase 5: Profile Page Integration

### Overview
Add the DepletionTargetInput component to the Profile page.

### Changes Required

#### 1. Update ProfileData Interface
**File**: `src/app/profile/profile-client.tsx`
**Location**: Add to `ProfileData` interface (line 69)

```typescript
  depletionTarget: DepletionTargetJson | null; // Epic 10: Spending target configuration
```

#### 2. Add Import
**File**: `src/app/profile/profile-client.tsx`
**Location**: Add to imports

```typescript
import { DepletionTargetInput } from '@/components/depletion-target-input';
import type { DepletionTargetJson } from '@/db/schema/financial-snapshot';
import type { DepletionTarget } from '@/lib/projections/types';
import { DEFAULT_MAX_AGE } from '@/lib/projections/assumptions';
```

#### 3. Add Change Handler
**File**: `src/app/profile/profile-client.tsx`
**Location**: After `handleSpendingPhasesChange` (line 174)

```typescript
  // Epic 10: Handler for saving depletion target (inline save, no dialog)
  const handleDepletionTargetChange = async (target: DepletionTarget) => {
    try {
      const response = await fetch('/api/profile', {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ depletionTarget: target }),
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.message || 'Failed to update spending target');
      }

      // Update local state
      setProfileData((prev) => ({
        ...prev,
        depletionTarget: target as DepletionTargetJson,
      }));
      toast({
        title: 'Spending target updated',
        description: 'Your spending target has been saved.',
      });
    } catch (error) {
      toast({
        title: 'Update failed',
        description: error instanceof Error ? error.message : 'Please try again.',
        variant: 'destructive',
      });
    }
  };
```

#### 4. Add Portfolio Value Calculation
**File**: `src/app/profile/profile-client.tsx`
**Location**: After `netWorthBreakdown` calculation (line 234)

```typescript
  // Calculate total portfolio value for depletion target display
  const totalPortfolioValue = profileData.investmentAccounts.reduce(
    (sum, acc) => sum + acc.balance,
    0
  );
```

#### 5. Add Collapsible Section
**File**: `src/app/profile/profile-client.tsx`
**Location**: After Spending Phases section (line 608)

```typescript
      {/* Epic 10: Spending Target Section */}
      <Collapsible
        title="Spending Target"
        defaultOpen={false}
      >
        <DepletionTargetInput
          target={profileData.depletionTarget as DepletionTarget | undefined}
          currentAge={currentAge ?? 65}
          maxAge={DEFAULT_MAX_AGE}
          portfolioValue={totalPortfolioValue}
          onChange={handleDepletionTargetChange}
        />
      </Collapsible>
```

#### 6. Update Server Component Data Fetch
**File**: `src/app/profile/page.tsx`
**Location**: Ensure `depletionTarget` is included in the data passed to `ProfileClient`

```typescript
// In the data transformation section, add:
depletionTarget: snapshot.depletionTarget ?? null,
```

### Success Criteria

#### Automated Verification:
- [x] TypeScript compiles: `npm run typecheck`
- [x] Linting passes: `npm run lint`
- [x] Build succeeds: `npm run build`

#### Manual Verification:
- [ ] Profile page loads without errors
- [ ] "Spending Target" collapsible section appears after "Spending Phases"
- [ ] Toggle enables/disables the feature
- [ ] Percentage slider works (0-100%)
- [ ] Age slider works (currentAge+1 to maxAge)
- [ ] Validation errors show for invalid age
- [ ] Toast appears on successful save
- [ ] Page refresh preserves saved settings
- [ ] Default values (50%, age 85) appear for new users

---

## Testing Strategy

### Unit Tests

**File**: `src/lib/validation/__tests__/depletion-target.test.ts` (new file)

```typescript
import { depletionTargetSchema, validateDepletionTarget } from '../projections';

describe('depletionTargetSchema', () => {
  const validTarget = {
    enabled: true,
    targetPercentageSpent: 75,
    targetAge: 80,
  };

  it('accepts valid target', () => {
    expect(depletionTargetSchema.safeParse(validTarget).success).toBe(true);
  });

  it('rejects percentage below 0', () => {
    expect(
      depletionTargetSchema.safeParse({
        ...validTarget,
        targetPercentageSpent: -1,
      }).success
    ).toBe(false);
  });

  it('rejects percentage above 100', () => {
    expect(
      depletionTargetSchema.safeParse({
        ...validTarget,
        targetPercentageSpent: 101,
      }).success
    ).toBe(false);
  });

  it('rejects non-integer age', () => {
    expect(
      depletionTargetSchema.safeParse({
        ...validTarget,
        targetAge: 80.5,
      }).success
    ).toBe(false);
  });
});

describe('validateDepletionTarget', () => {
  it('rejects target age <= current age', () => {
    const result = validateDepletionTarget(
      { enabled: true, targetPercentageSpent: 75, targetAge: 60 },
      65,
      90
    );
    expect(result.valid).toBe(false);
    expect(result.errors).toContain(
      'Target age (60) must be greater than your current age (65)'
    );
  });

  it('rejects target age > maxAge', () => {
    const result = validateDepletionTarget(
      { enabled: true, targetPercentageSpent: 75, targetAge: 95 },
      65,
      90
    );
    expect(result.valid).toBe(false);
    expect(result.errors).toContain(
      'Target age (95) cannot exceed your life expectancy (90)'
    );
  });

  it('accepts valid target within range', () => {
    const result = validateDepletionTarget(
      { enabled: true, targetPercentageSpent: 75, targetAge: 80 },
      65,
      90
    );
    expect(result.valid).toBe(true);
    expect(result.errors).toHaveLength(0);
  });
});
```

### Integration Tests

- [ ] API PATCH with valid depletionTarget returns 200
- [ ] API PATCH with invalid percentage returns 400
- [ ] Database stores and retrieves depletionTarget correctly

### Manual Testing Steps

1. Navigate to Profile page
2. Scroll to "Spending Target" section
3. Enable the toggle - verify inputs appear
4. Set percentage to 75% - verify slider and input sync
5. Set age to 80 - verify slider and input sync
6. Verify projected reserve calculation is correct
7. Refresh page - verify settings persist
8. Set age to current age - verify validation error appears
9. Set age to > life expectancy - verify validation error appears
10. Disable toggle - verify inputs hide

---

## Performance Considerations

- Component uses local state with debounced validation
- API calls only on valid saves (not on every keystroke)
- No additional database queries required (data included in existing profile fetch)

---

## Migration Notes

- New JSONB column is nullable, no data migration needed
- Existing users will see disabled state by default
- No breaking changes to existing functionality

---

## References

- Original ticket: `thoughts/personal/tickets/epic-10/story-1-scope.md`
- Research document: `thoughts/shared/research/2026-01-22-ENG-10.1-implementation-recommendation.md`
- Similar implementation: `src/components/spending-phase-editor.tsx`
- Profile page: `src/app/profile/profile-client.tsx:599-608`
